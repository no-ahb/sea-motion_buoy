# TODO: Ocean Motion Sensing Buoy
*Active development & task tracking — maintained by agents*

**Last updated:** 2024-11-03 – Added header metadata/CRC, QA sampling, decoder PSD tools, 30 s bias.

---

## To Do Now (go through this, erase any tasks completed, add them to the changelog, update "last updated" with brief memo of tasks completed, renumber or edit remaining tasks )
1. Run 1 h desk soak with new 30 s bias to confirm stability & log QA CSV results.
2. Use decoder PSD tooling on next dataset to pick default high-pass cutoff.


---

## Task Whiteboard (ideas for later implementation)
1. Enhance Desktop Decoder 
* Parse header → compute true sample rate → CSV export.
* Validate quaternion normalization and report mean norm.
* Plot optional quick-look graphs (acceleration, orientation).
* Output metadata: recording duration, sample count, rate stats.

2. Implement Post-Processing Workflow
* Compute **Up vector** from quaternion → project linear accel → `a_z`.
* Apply **high-pass (0.03–0.07 Hz)** and integrate twice → displacement.
* Downsample → normalize → output CSV for stepper playback.

### Firmware

* [x] Integrate double-buffer + block write system for stable 100–200 Hz logging.
* [x] Add "effective sample rate" metadata to log or sidecar file.
* [x] Add per-file CRC + enriched header metadata for data integrity.
* [ ] Optimize power (reduce SD writes, limit LED use during idle).
* [x] Retain LED/button FSM (bias → ready → recording → stop).

### Decoder & Processing
* [ ] Extend decoder to export CSV / NumPy formats.
* [ ] Add metadata extraction (session length, sample count, rate).
* [ ] Implement optional plotting for QA (accel, quaternion norm).
* [ ] Add basic displacement reconstruction (time- or frequency-domain).

### Testing
* [ ] Measure true sampling rate under different block sizes.
* [ ] Verify bias stability after 20 s still phase.
* [ ] Confirm linear accel ≈ 0 at rest.
* [ ] Validate data integrity over 10 h runs.

### Documentation
* [ ] Document calibration / bias routine.
* [ ] Record measured power draw and runtime.

### Hardware
* [ ] Finalize 10–15 cm buoy hull design.
* [ ] Document waterproofing and internal mounting.
* [ ] Create assembly instructions.

---

## Feature Suggestions

### Short-Term
* [x] Add recording metadata (device ID, start time, duration) to header.
* Add LED “error” pattern (fast blink) for SD/IMU init failures.

### Long-Term
* [x] Add gyro snapshots for QA logging (every 5 s during runs).

### Someday / Nice-to-Have
1. **BNO08x UART mode (≥1 Mbps) for future >100 Hz logging** – Swap the IMU link from I²C to UART when higher rates are needed; lowers bus latency and jitter but increases wiring/driver complexity.
2. **Back-pressure metrics and watchdog** – Record queue depth/overrun stats and flash a warning pattern if the writer saturates; valuable for post-mortem analysis with negligible runtime cost.
3. **Periodic fsync checkpoints (every 30–60 s)** – Bound data loss on sudden power cuts at the expense of predictable, brief SD stalls during each sync.
4. **Driver micro-optimizations / optional C shim** – Rework BNO08x caches to reuse arrays or port hot paths to C for lower latency; improves headroom but raises maintenance overhead.
